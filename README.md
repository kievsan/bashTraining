## bash traning

1. Напишите конвейер, который будет использовать команды ps, grep и awk для мониторинга активных процессов в системе. Результаты должны быть отсортированы по использованию ресурсов, и информация должна быть записана в файл «system_monitoring.txt».
```bash
ps aux --sort -%mem | grep -v grep | awk '{print $1, $2, $3, $4, $5, $6, $11}' > system_monitoring.txt

```

2. Напишите конвейер, который сравнивает содержимое двух директорий. Используйте команды find, sort, и diff для поиска и сравнения файлов в двух директориях. Результат сравнения сохраните в файл «directory_comparison.txt».
```sh
#!/bin/bash

# Запрашиваем пути к директориям
read -p "Введите полный путь к первой директории: " dir1
read -p "Введите полный путь ко второй директории: " dir2

# Проверяем, есть ли такие директории
if [ ! -d "$dir1" ] || [ ! -d "$dir2" ]; then
  echo "Одна из директорий не найдена!"
  exit 1
fi

# Сравнениваем содержимое директорий и пишем в файл
diff <(find "$dir1" -type f | sort) <(find "$dir2" -type f | sort) > directory_comparison.txt

echo "Success:   directory_comparison.txt"
```

3. Напишите конвейер для подсчета общего числа строк во всех текстовых файлах в указанной директории, используя find, xargs и wc.

```sh
#!/bin/bash

# dir - путь к директории
read -p "Введите полный путь к директории: " dir

# Ищем директорию
if [ ! -d "$dir" ]; then
  echo "Директория не найдена!"
  exit 1
fi

# Считаем общее количество строк во всех текстовых файлах
all_lines=$(find "$dir" -type f -name "*.txt" | xargs wc -l | awk '{total += $1} END {print total}')

echo "Всего $all_lines строк во всех текстовых файлах"
```

4. Напишите конвейер, который использует команды df, sort и awk для мониторинга использования дискового пространства и записывает результаты в файл «disk_space_usage.txt».
```bash
df -h | sort -hr -k 5 > disk_space_usage.txt

```

5. Напишите конвейер, который использует команды cat, grep, awk, sort и tar для фильтрации строк с ключевым словом в лог-файлах, сортировки и архивации результатов.
```sh
#!/bin/bash

# Запрос вводных
read -p "Введите полный путь к логам: " logs_path
read -p "Введите ключевое слово: " keyword

# Поиск директории
if [ ! -d "$logs_path" ]; then
  echo "Директория не найдена!"
  exit 1
fi

# Фильтрацуем, сортируем и архивируем результат
cat "$logs_path"/*.log 2>/dev/null | grep "$keyword" | sort > filtered.txt && tar -czf filtered.tar.gz filtered.txt

echo "Success"
```

2.1. Создайте Bash-скрипт, который будет проверять доступность нескольких хостов в вашей локальной сети. Список хостов (IP-адреса или доменные имена) должен быть задан в переменной в начале скрипта. Скрипт должен последовательно проверять каждый хост на доступность с использованием команды ping. Если хост доступен, выведите сообщение «Хост [ИМЯ ХОСТА] доступен», если нет — выведите сообщение «Хост [ИМЯ ХОСТА] недоступен». В конце скрипта выведите общее количество доступных и недоступных хостов.
```sh
#!/bin/bash

# Запросим список хостов
read -p "Введите через пробел IP-адреса или доменные имена хостов: " -a hosts

# Получен хотя бы один хост?
if [ ${#hosts[@]} -eq 0 ]; then
  echo "Ошибка: нет данных!"
  exit 1
fi

# Инициализация счетчиков
available_counter=0
unavailable_counter=0

# Проверяем хосты на доступность
for host in "${hosts[@]}"; do
  if ping -c 1 "$host" &> /dev/null; then
    echo "Хост $host доступен"
    ((available_counter++))
  else
    echo "Хост $host недоступен"
    ((unavailable_counter++))
  fi
done

# Вывод результатов
echo "Всего доступных хостов: $available_counter"
echo "Всего недоступных хостов: $unavailable_counter"
```

2.2 Напишите Bash-скрипт для анализа лог-файлов в указанной директории. Скрипт должен найти все файлы с расширением «.log» в указанной директории и подсчитать количество строк, содержащих определенное ключевое слово (например, «ERROR» или «Exception»). Ключевое слово должно быть задано в переменной в начале скрипта. Скрипт должен выводить сообщение в формате: «Файл [ИМЯ ФАЙЛА] содержит [КОЛИЧЕСТВО СТРОК С КЛЮЧЕВЫМ СЛОВОМ] строк с ключевым словом [КЛЮЧЕВОЕ СЛОВО]». В конце скрипта выведите общее количество строк с ключевым словом по всем лог-файлам в данной директории.
```sh
#!/bin/bash

# Вводные
read -p "Введите путь к директории с логами: " logs_dir
read -p "Введите ключевое слово для поиска: " keyword

# Поиск директории
if [ ! -d "$logs_dir" ]; then
  echo "Ошибка: папка $logs_dir не найдена!"
  exit 1
fi

line_counter=0

# Все.log файлы в указанной директории
shopt -s nullglob # разворачивает в пустой список, если *.log файлов нет
for log_file in "$logs_dir"/*.log; do
  if [ -f "$log_file" ]; then
    # строк с ключевым словом в текущем лог-файле
    lines=$(grep -c "$keyword" "$log_file" 2>/dev/null)
    
    # ошибки выполнения grep
    if [ $? -ne 0 ]; then
      echo "Ошибка обработки файла $log_file"
      continue
    fi
    
    # инфа о текущем файле
    echo "Файл $log_file содержит $lines строк с ключевым словом '$keyword'"
    
    # Обновим общий счетчик
    line_counter=$((line_counter + lines))
  else
    echo "Файл $log_file не найден!"
  fi
done

# Всего строк с ключевым словом
echo "С ключевым словом '$keyword' в лог-файлах найдено $line_counter строк"
```
